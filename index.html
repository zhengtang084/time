<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- === æ–°å¢ï¼šSEO ä¼˜åŒ–ï¼ˆæå‡æœç´¢å¼•æ“æ”¶å½•ä¸ç¤¾äº¤åˆ†äº«æ•ˆæœï¼‰=== -->
    <title>åšè°ˆå½±åƒæ¡£æ¡ˆåº“ ChinaTime - å†å²å½±åƒæ—¶é—´æœºå™¨</title>
    <meta name="description" content="åšè°ˆç½‘å†å²å½±åƒæ¡£æ¡ˆåº“ï¼Œæ”¶å½•2014å¹´ä»¥æ¥å¾®åšè°ˆã€å¾®å†å²ã€å¾®è§†é‡ç­‰æ ç›®ç»å…¸å›¾ç‰‡ï¼Œæ”¯æŒæ—¶é—´è½´ã€æœç´¢ã€å¤šè¯­è¨€æµè§ˆï¼Œéå•†ä¸šå­¦æœ¯ç ”ç©¶ä¸“ç”¨ã€‚">
    <meta name="keywords" content="åšè°ˆç½‘,å†å²å½±åƒ,å¾®åšè°ˆ,å¾®å†å²,å¾®è§†é‡,ä¸­å›½æ¡£æ¡ˆ,äº’è”ç½‘å†å²,å›¾ç‰‡åº“,åšè°ˆå½±åƒæ¡£æ¡ˆåº“,äº’è”ç½‘å†å²å½±åƒåº“">
 

    
    <!-- Open Graphï¼ˆå¾®ä¿¡ã€Twitterã€Facebook ç­‰åˆ†äº«æ—¶æ˜¾ç¤ºæ¼‚äº®å¡ç‰‡ï¼‰ -->
    <meta property="og:title" content="åšè°ˆå½±åƒæ¡£æ¡ˆåº“ ChinaTime - å†å²å½±åƒæ—¶é—´æœºå™¨">
    <meta property="og:description" content="æµ·é‡åšè°ˆç½‘å†å²å½±åƒï¼Œæ”¯æŒæ—¶é—´è½´ç­›é€‰ã€å…³é”®è¯æœç´¢ã€å¤šè¯­è¨€åˆ‡æ¢ã€‚">
    <meta property="og:image" content="https://yourdomain.com/preview.jpg"> <!-- è¯·æ›¿æ¢ä¸ºä½ çš„é¢„è§ˆå›¾é“¾æ¥ -->
    <meta property="og:url" content="https://yourdomain.com/">
    <meta property="og:type" content="website">
    
    <!-- å¼ºåˆ¶ HTTPSï¼ˆæå‡å®‰å…¨ï¼‰ -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <!-- === æ–°å¢ç»“æŸ === -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0066cc;
            --main-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-muted: #666666;
            --border-color: #e0e0e0;
            --input-bg: #ffffff;
            --control-bg: #f1f3f5;
            --thumb-color: #0066cc;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #4d88ff;
                --main-bg: #1e1e1e;
                --card-bg: #2d2d2d;
                --text-main: #e0e0e0;
                --text-muted: #aaaaaa;
                --border-color: #444444;
                --input-bg: #333333;
                --control-bg: #3a3a3a;
                --thumb-color: #4d88ff;
            }
        }

        html, body {
            overflow-x: hidden;
            width: 100%;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: "Segoe UI", system-ui, -apple-system, "Microsoft YaHei", "PingFang SC", sans-serif; 
            background-color: var(--main-bg); 
            color: var(--text-main); 
            min-width: 0;
            transition: all 0.3s ease;
        }

        /* å…¶ä½™åŸæœ‰æ ·å¼ä¿æŒä¸å˜ï¼Œç›´åˆ° date-group-header */

        .date-group-header {
            column-span: all;
            break-inside: avoid;
            padding: 15px 20px;           /* æ–°å¢ï¼šæ›´å¤§å†…è¾¹è·ï¼Œæ›´èˆ’é€‚ */
            margin: 30px 0 20px;          /* æ–°å¢ï¼šæ›´å¤§é—´è·ï¼Œæ›´çªå‡ºåˆ†ç»„ */
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color); 
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 0;
            background: var(--control-bg); /* æ–°å¢ï¼šæµ…è‰²èƒŒæ™¯ï¼Œè®©æ—¥æœŸæ ‡é¢˜åœ¨å¤šåˆ—ä¸­æ›´é†’ç›® */
            border-radius: 8px;            /* æ–°å¢ï¼šåœ†è§’ï¼Œæ›´ç°ä»£ */
        }

        /* Lightbox å›¾ç‰‡åœ¨å°å±å¹•ä¼˜åŒ– */
        #lightbox-img {
            max-width: 95vw;   /* æ–°å¢ï¼šæ‰‹æœºä¸Šä¸æº¢å‡º */
            max-height: 80vh;  /* æ–°å¢ï¼šç•™å‡ºç©ºé—´ç»™æè¿°å’ŒæŒ‰é’® */
            object-fit: contain;
        }

        /* å…¶ä½™æ ·å¼ä¿æŒåŸæ · */
    </style>
</head>
<body>

<!-- ç§»åŠ¨ç«¯æ±‰å ¡èœå•æŒ‰é’® -->
<button id="mobile-menu-btn" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</button>

<!-- ä¾§è¾¹æ å®¹å™¨ï¼ˆä¿æŒåŸæ ·ï¼‰ -->
<div id="sidebar-container">
    <div id="sidebar">
        <!-- ä¾§è¾¹æ å†…å®¹ä¿æŒåŸæ · -->
        <h2 id="ui-title">ğŸ® æ§åˆ¶å°</h2>
        <div class="sidebar-item">
            <label class="label-text" id="ui-lang-label">ğŸŒ è¯­è¨€åˆ‡æ¢/Language</label>
            <select id="lang-select" onchange="changeLang(this.value)"></select>
        </div>
        <div class="stats-box">
            <span class="label-text" id="ui-stats-label">ğŸ“Š å…¨é¦†å½±åƒæ€»è®¡</span>
            <span id="total-count">...</span>
            <small id="ui-unit">å·</small>
        </div>
        <div class="sidebar-item">
            <label class="label-text" id="ui-cat-label">ğŸ“‚ æ ç›®ç­›é€‰</label>
            <div class="radio-group" id="category-group"></div>
        </div>
        <div class="sidebar-item">
            <label class="label-text" id="ui-search-label">æœç´¢æ¡£æ¡ˆå†…å®¹</label>
            <div class="search-wrapper">
                <input type="text" id="search-input" class="search-input" placeholder="...">
                <button class="btn-search" id="btn-search-trigger"><i class="fas fa-search"></i></button>
            </div>
        </div>
        
        <div class="sidebar-item">
            <div class="label-row"><span class="label-text" id="ui-slider-label">â³ æ—¶é—´è½´</span><span id="date-display">...</span></div>
            <input type="range" id="date-slider" style="width:100%">
            <div class="range-sub-info">
                <span>2014-02-12</span>
                <span id="latest-date-label">...</span>
            </div>
        </div>

        <div class="sidebar-item">
            <div class="label-row"><span class="label-text" id="ui-grid-label">ğŸ–¼ï¸ åˆ—æ•°</span><span id="grid-display">3</span></div>
            <input type="range" id="grid-slider" min="1" max="6" value="3" style="width:100%">
        </div>
    </div>
</div>

<div id="main-content">
    <h1 id="ui-main-title">â³ å†å²å½±åƒæ—¶é—´æœºå™¨</h1>
    <div id="search-info" style="margin-bottom: 25px; color: var(--text-muted); font-size: 14px;"></div>
    <div class="gallery" id="gallery"></div>
    <button id="load-more">åŠ è½½æ›´å¤š...</button>

    <div id="copyright-notice">
        <p>å›¾ç‰‡ç‰ˆæƒå±äºåšè°ˆç½‘ <a href="https://botanwang.com/" target="_blank">https://botanwang.com/</a></p>
        <p>æ‰€æœ‰å½±åƒä»…ä¾›å­¦æœ¯ç ”ç©¶ä¸éå•†ä¸šå‚è€ƒä½¿ç”¨ï¼Œæœªç»è®¸å¯ç¦æ­¢è½¬è½½ã€å•†ç”¨æˆ–äºŒæ¬¡å‘å¸ƒã€‚</p>
    </div>
</div>

<div id="lightbox">
    <button class="lb-btn lb-close" onclick="closeLb()"><i class="fas fa-times"></i></button>
    
    <!-- === æ–°å¢ï¼šä¸‹è½½æŒ‰é’®ï¼ˆLightbox ä¸­ç›´æ¥ä¸‹è½½å½“å‰å›¾ç‰‡ï¼‰=== -->
    <a id="lb-download" class="lb-btn" style="right:80px; pointer-events:auto;" target="_blank">
        <i class="fas fa-download"></i>
    </a>
    <!-- === æ–°å¢ç»“æŸ === -->

    <div class="lb-nav">
        <button class="lb-btn" onclick="moveLb(-1)"><i class="fas fa-chevron-left"></i></button>
        <button class="lb-btn" onclick="moveLb(1)"><i class="fas fa-chevron-right"></i></button>
    </div>
    <img id="lightbox-img" alt="">
    
    <!-- === æ–°å¢ï¼šå›¾ç‰‡åºå·æ˜¾ç¤ºï¼ˆå¦‚ â€œ3 / 156â€ï¼‰=== -->
    <div id="lb-counter" style="color:white; margin-top:15px; font-size:14px; opacity:0.8;"></div>
    <!-- === æ–°å¢ç»“æŸ === -->
    
    <div id="lb-caption" style="color:white; margin-top:25px; text-align:center; padding:0 40px; max-width: 800px; font-size:14px; line-height:1.6;"></div>
    <div id="lb-copyright">å›¾ç‰‡ç‰ˆæƒå±äºåšè°ˆç½‘ https://botanwang.com/</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    /* æ‰€æœ‰åŸæœ‰å‡½æ•°ä¿æŒä¸å˜ï¼ˆtoggleSidebarã€initUIã€fetchGlobalTotal ç­‰ï¼‰ */

    // ä½ çš„åŸæœ‰ä»£ç å…¨éƒ¨ä¿ç•™ï¼Œç›´åˆ° initUI(); è°ƒç”¨

    initUI();

    // === åŸæœ‰ + ä¿ç•™ï¼šé”®ç›˜å·¦å³æ–¹å‘é”®åˆ‡æ¢ + Esc å…³é—­ ===
    document.addEventListener('keydown', (e) => {
        const lightbox = document.getElementById('lightbox');
        if (lightbox.style.display === 'flex') {
            e.preventDefault();
            if (e.key === 'ArrowLeft') moveLb(-1);
            else if (e.key === 'ArrowRight') moveLb(1);
            else if (e.key === 'Escape') closeLb();
        }
    });

    // === æ–°å¢ï¼šæ— é™æ»šåŠ¨ï¼ˆæ»šåŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½ï¼Œå–ä»£â€œåŠ è½½æ›´å¤šâ€æŒ‰é’®ï¼‰===
    state.loading = false; // æ·»åŠ çŠ¶æ€é˜²æ­¢é‡å¤åŠ è½½
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
            if (state.allImages.length < state.totalSearchCount && !state.loading) {
                state.loading = true;
                state.page++;
                refreshData().then(() => state.loading = false);
            }
        }
    });
    // éšè—åŸæœ‰æŒ‰é’®ï¼ˆæ— é™æ»šåŠ¨æ›´æµç•…ï¼‰
    document.getElementById('load-more').style.display = 'none';
    // === æ–°å¢ç»“æŸ ===

    // === æ–°å¢ï¼šæ›´æ–° Lightbox æ—¶è®¾ç½®ä¸‹è½½é“¾æ¥ + å›¾ç‰‡åºå· ===
    function updateLb() {
        const item = state.allImages[state.currentLbIdx];
        document.getElementById('lightbox-img').src = item.image_url;
        document.getElementById('lb-caption').innerText = item.description || '';
        document.getElementById('lb-copyright').innerText = 'å›¾ç‰‡ç‰ˆæƒå±äºåšè°ˆç½‘ https://botanwang.com/';
        
        // ä¸‹è½½æŒ‰é’®ï¼šç›´æ¥ä¸‹è½½å½“å‰å›¾ç‰‡ï¼Œæ–‡ä»¶åå¸¦æ—¥æœŸ
        const downloadBtn = document.getElementById('lb-download');
        downloadBtn.href = item.image_url;
        downloadBtn.download = `botan_${item.production_date || 'unknown'}.jpg`;
        
        // å›¾ç‰‡åºå·æ˜¾ç¤º
        document.getElementById('lb-counter').innerText = 
            `${state.currentLbIdx + 1} / ${state.allImages.length}`;
    }
    // === æ–°å¢ç»“æŸ ===
</script>
</body>
</html>
